Draft Manual for ESP-909
Simple operating guide 
Slider2732 - September 2021


Contents
--------

Play It!
Pattern Copy
Pattern Chain
Tempo
Swing (shuffle)
MIDI
Construction notes




Play It!
--------

When the USB cable is connected to the ESP8266, the unit powers up into Live Play mode.
Live Play mode is denoted by the LED being constantly lit. 
Press any drum button to hear each sound, practice patterns, add a live layer to a pre-recorded track etc.
When in this mode, the Function button on the right side end of the drum buttons becomes very powerful.
Press button 1 (Bass Drum) along with Function to execute Pattern Copy.
Press button 2 (Snare) along with Function to execute Pattern Chain.
More features are intended to be added.
When ready to record, press the Record/Live mode button.
Tempo can be set with the relevant pot, BPM indication is with a flash of the LED on positions 1, 9 and 11 of the 16 part pattern.
Each drum sound will be quantized to 1/16th of the pattern.
If unhappy with a sound, press the same button again to remove it (easiest if the tempo is temporarily lowered).
Variations in swing (shuffle) can be made by using the Swing pot.
To swap to pattern 2, press the Function button. 
To return to Live mode, press the Record/Live mode button at any time. 
To pause playback of a pattern, press the Pause/Play button. The pattern will stop at the end of its 16 note sequence and will restart the instant the button is released.
To reset the drum machine, press the Reset button.


Pattern Copy
------------
Press button 1 (Bass Drum) along with Function.
Pattern 1 will be copied to pattern 2.
The LED will flash a sequence and a sound will be heard.
Returning to Record mode using the Record mode button will result in both patterns sounding the same. Changes to patterns 1 or 2 can be made in the same regular way. Pattern copy allows for a variation on pattern 2, or, as a backup of pattern 1.  


Pattern Chain
-------------
Press button 2 (Snare Drum) along with Function.
Pattern 2 will be added to the end of pattern 1.
The pattern length of the sequence will now be 32 beats. 
The LED will remain off for a second while performing the chain and then a sound will be heard. The LED behaves in this way, to confirm to the player that he/she has pressed the correct button. 
Returning to Record mode using the Record mode button will result in the full 32 steps being played.
N.B. Pressing the Function button to swap to pattern 2 results in no action.  


Tempo
-----
Tempo is changed by using the Tempo pot.
The range is approximately 40 BPM to 300 BPM.
Indication of the tempo is given by the LED, with flashes on pattern positions 1,9 and 11.
Original intentions were to use a bright flash plus several lower intensity flashes, more in keeping with a traditional metronome, but PWM didn't appear to play well when running within the code. Was fine on its own and is something to return to, to fix.  


Swing
-----
Swing, or shuffle, at this early stage of development is a simple measurement of the swing pot position, divided down. 
Each second beat is delayed by the swing amount, with the remaining beat time length shortened after the drum sound is fired. 
The code will be updated to Roger Linn's % method.
For now, it allows useful timing variations and experimentation with pattern structures, creating a different feel to played patterns.   


MIDI
----
MIDI In and Out are implemented, but so far are proving difficult to get running.
Jan Ostman's initial codebase for ESP-909 includes MIDI functionality and somewhere along development I may have borked it!
This manual will be updated when it's fixed. It may work for you as it stands, my MIDI circuit is homemade from salvaged components. 
MIDI commands in both directions will be Start/Stop, Pause and Note data. 




Construction Notes
------------------

With reference to the prototype build picture on Github. 

Components required -
Wemos D1 Mini (ESP8266)
HC4067 16 port multiplexer
15 momentary action buttons
2x 5K pot
MIDI circuit (Sparkfun/Adafruit etc, or homemade)
100uF 16V capacitor
1nF (103) ceramic capacitor
1x LED, with 100 ohm resistor to protect it
2 pin connector 
Large perfboard (12cm x 18cm)

The layout is up to you, here is how the prototype circuit is arranged -
Top left is the Wemos D1 Mini, underneath the board. 
Output audio is from the RX pin, the audio filter consisting of 100uF electrolytic cap and 1nf ceramic cap are connected to it. A 2 pin header connector is a simple way to enable or disable the RX pin for code uploads. 
Top middle is the MIDI circuit. 
Top right is the Reset button, connected to GND and RST on the Wemos D1 Mini.
Middle left are the Tempo pot (5K), LED, Swing pot (5K) and an unused pot, perhaps for reverb or pitch later in development.  
Middle right are the Record/Live mode button and Play/Pause button.
Bottom row is for the drum sounds, 1 button per sound, matching the placement of the TR-909 drum sounds. 
Bottom row right, is the Function button.

A look through the code will determine the correct connections. 
The code has been commented with hopefully useful information. 

Here is a reference guide to those connections - 

 Wemos D1 Mini pins:
 D0 - Play/Pause
 D1 - S3
 D2 - S2
 D3 - Tempo LED
 D4 - 
 D5 - S0
 D6 - S1
 D7 - RX MIDI
 D8 - TX MIDI
 A0 - Input from multiplexer

 16 channel Multiplexer
 ports 0 - 10 drum sounds buttons
 port[11] Pattern swap button
 port[12] Swing amount pot
 port[13] Unused pot
 port[14] Record/Live button
 port[15] Tempo pot



